function unbindPusherChannels(){for(;pusherConnections.length>0;)channel=pusherConnections.pop(),channel.disconnect()}var pusherConnections=[];elmApp.ports.pusherLogout.subscribe(function(){unbindPusherChannels()}),elmApp.ports.pusherLogin.subscribe(function(n){unbindPusherChannels(),n.channelNames.forEach(function(e){var o=new Pusher(n.key,{cluster:n.cluster,authEndpoint:n.authEndpoint});if(pusherConnections.push(o),o.connection.bind("error",function(n){elmApp.ports.pusherError.send({message:n.error.data.message?n.error.data.message:null,code:n.error.code?n.error.code:null})}),o.connection.bind("state_change",function(n){elmApp.ports.pusherState.send(n.current)}),!o.channel(e)){var r=o.subscribe(e);n.eventNames.forEach(function(n){r.bind(n,function(e){e.clientTimestamp=Date.now();var o={eventType:n,data:e};if("force_reload"==n){var r=Math.floor(20*Math.random()+1);setTimeout(function(){location.reload()},1e3*r)}else elmApp.ports.pusherIncomingEvents.send(o)})})}})});